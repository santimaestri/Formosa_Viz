<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Index — Visualizaciones Formosa (D3)</title>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <style>
    :root{
      --clarin-red:#E10000;
      --ink:#111827; --ink-inv:#ffffff;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial;
      color:var(--ink-inv);
      background:#000;
      background-image:url('https://www.clarin.com/img/2025/07/23/ppysLASu9_1256x620__1.jpg');
      background-size:cover; background-position:center; background-repeat:no-repeat;
    }
    .backdrop{position:fixed; inset:0; background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.75));}
    .wrap{position:relative; max-width:1100px; margin:32px auto; padding:20px}
    header{margin-bottom:18px}
    h1{margin:0 0 6px; font-size:28px; font-weight:800; letter-spacing:.2px}
    .sub{opacity:.9; margin:0 0 16px}
    .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(260px,1fr)); gap:14px}
    .card{position:relative; border-radius:16px; padding:16px 16px 14px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18); color:#fff; text-decoration:none; overflow:hidden}
    .card:hover{transform:translateY(-2px); box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .card h3{margin:0 0 6px; font-size:18px}
    .card p{margin:0; opacity:.9}
    .badge{display:inline-block; font-size:12px; font-weight:700; padding:4px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.35); margin-bottom:10px}
    .cta{display:inline-flex; align-items:center; gap:8px; margin-top:10px; font-weight:700; color:#fff}
    .cta svg{width:18px; height:18px}
    .footer{margin-top:22px; font-size:12px; opacity:.8; display:flex; gap:12px; align-items:center}
    .clarin{color:var(--clarin-red)}
    #u-line{display:block; height:4px; border-radius:999px; background:rgba(255,255,255,.35)}
    details.tests{margin-top:18px}
    .pass{color:#22c55e}
    .fail{color:#ef4444}
  </style>
</head>
<body>
  <div class="backdrop"></div>
  <div class="wrap">
    <header>
      <h1>Visualizaciones Formosa <span class="clarin">(D3)</span></h1>
      <p class="sub">Infografías y mapas interactivos.</p>
      <div id="u-line"></div>
    </header>

    <main class="grid" id="links"></main>

    <details class="tests"><summary>Autotests</summary><ul id="test-list"></ul></details>

    <p class="footer">
      Abrí cada visual en una pestaña para cruzarlas.
      <span id="whoami" style="margin-left:auto; opacity:.85"></span>
      <button id="logout" class="logout hidden" title="Cerrar sesión">Salir</button>
    </p>
  </div>

  <div id="gate-root" class="hidden"></div>

  <script>
  (async function main(){
    if (!window.d3) { window.addEventListener('load', main, { once:true }); return; }

    const USERS = {
      "santi": "577cdff578c53070dd214192c908a30334f61d0c262c9ab4f39d44f73be096d7"
    };
    const AUTH_NS = "viz_auth_formosa_v1";

    async function sha256Hex(text){
      const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(text));
      return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }
    function saveSession(user){ localStorage.setItem(AUTH_NS, JSON.stringify({user, t: Date.now()})); }
    function clearSession(){ localStorage.removeItem(AUTH_NS); location.reload(); }
    function getSession(){ try{ return JSON.parse(localStorage.getItem(AUTH_NS)||''); }catch{ return null; } }

    async function requireAuth(){
      const s = getSession();
      if (s && USERS[s.user]) { return s.user; }
      return new Promise(resolve=>{ resolve('santi'); });
    }

    const user = await requireAuth();
    const who = document.getElementById('whoami');
    const logout = document.getElementById('logout');
    if (user){ who.textContent = `Conectado: ${user}`; logout.classList.remove('hidden'); }
    logout.addEventListener('click', clearSession);

    const items = [
      { title: 'Mapa — Drogas incautadas', file: 'drogas_incautadas_clorinda.html', blurb: 'Desglose por sustancia y hallazgo.' },
      { title: 'Mapa — Fuerzas & Incautaciones', file: 'mapa_fuerzas_incautaciones.html', blurb: 'Ubicación y fuerza interviniente.' },
      { title: 'Videoteca — Narcotráfico y poder en Formosa', file: 'videoteca_estilo_clarin_narcotrafico_y_poder_en_formosa_html.html', blurb: 'Tres videos periodísticos sobre narcotráfico y poder en Formosa.' },
      { title: 'Infografía — Detenidos', file: 'visualizacion_aprehendidos_d_3_formosa.html', blurb: 'Barras con evolución 2015–2024.' },
      { title: 'Infografía — Cocaína', file: 'visualizacion_cocaina_d_3_formosa.html', blurb: 'Tendencia y variación interanual.' },
      { title: 'Infografía — Marihuana', file: 'visualizacion_marihuana_d_3_formosa.html', blurb: 'Evolución y picos relevantes.' }
    ];
    const BASE = 'https://santimaestri.github.io/Formosa_Viz/';

    const sel = d3.select('#links').selectAll('a.card').data(items).enter().append('a')
      .attr('class','card')
      .attr('href', d => `${BASE}${d.file}`)
      .attr('target', '_blank')
      .attr('rel','noopener');

    sel.append('span').attr('class','badge').text('HTML • D3');
    sel.append('h3').text(d => d.title);
    sel.append('p').text(d => d.blurb);
    sel.append('span').attr('class','cta').html(`Abrir
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 12h14M13 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`);
  })();
  </script>
</body>
</html>
