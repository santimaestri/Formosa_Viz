<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nube de palabras — consolidado_keywords</title>
  <style>
    :root {
      --bg:#ffffff; --panel:#ffffff; --ink:#222222; --line:#cccccc; --link:#c00;
    }
    * { box-sizing: border-box; }
    body { font-family: Arial, Helvetica, sans-serif; margin: 0; background:var(--bg); color:var(--ink); }
    .banner {
      background-color: var(--link);
      color: #fff;
      padding: 10px 20px;
      font-size: 22px;
      font-weight: bold;
      border-bottom:4px solid #900;
    }
    header { padding: 16px 20px; border-bottom: 2px solid var(--line); background:var(--bg); }
    h1 { margin: 0; font-size: 20px; line-height: 1.2; color:var(--ink); }
    .description { font-size: 14px; color: #555; margin-left: 10px; max-width: 500px; }
    .controls { display:flex; gap:12px; align-items:center; flex-wrap: wrap; margin-top: 8px; }
    label { font-size: 14px; display:flex; gap:8px; align-items:center; }
    input[type="range"], select { width: 200px; }
    #canvas-container { width: 100vw; height: calc(100vh - 150px); display:flex; align-items:center; justify-content:center; padding: 12px; }
    #wordcloud { width: 100%; height: 100%; background:var(--panel); border-radius: 16px; border:1px solid var(--line); }
    .badge { font-size:12px; background:var(--link); color:#fff; padding:4px 8px; border-radius:9999px; }
    button { padding:8px 12px; border-radius:4px; border:1px solid var(--line); background:var(--link); color:#fff; cursor:pointer; }
    button:hover { filter:brightness(1.1); }
  </style>
</head>
<body>
  <div class="banner">Clarín Interactivos</div>
  <header>
    <h1 style="display:flex;align-items:flex-start;gap:14px;flex-wrap:wrap;">
      <span>Nube de palabras — consolidado_keywords <span id="badgeCount" class="badge">Top 78</span></span>
      <small style="max-width:720px;font-weight:400;color:#555;line-height:1.3;">Explicativo: esta nube muestra las <b>palabras más frecuentes</b> extraídas de los videos de la videoteca. Seleccioná un <b>video</b> para ver su nube específica o elegí <b>“Todos”</b> para el consolidado.</small>
    </h1>
    <div class="controls">
      <label><span>Video:</span>
        <select id="videoSelect"></select>
      </label>
      <label><span>Tamaño máx:</span> <input id="maxSize" type="range" min="12" max="120" value="64"></label>
      <label><span>Rotación:</span> <input id="rotate" type="range" min="0" max="90" value="30"></label>
      <button id="regen" title="Rebarajar y redibujar">Regenerar</button>
      <span style="font-size:13px;opacity:.85">Tip: click en una palabra para buscarla en Google</span>
    </div>
  </header>
  <div id="canvas-container">
    <div id="wordcloud" role="img"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.min.js"></script>
  <script>
    // === Datos embebidos generados desde consolidado_keywords.csv ===
    const TITLES = {"JlZFjTFVjuE":"La sombra del narcotráfico en el entorno de Gildo Insfrán","fLi3VY802o8":"¡30 años en el poder! ¿Cómo lo logró Gildo Insfrán? | Por Douglas Farah","pliyp3R-XYA":"Fuerte denuncia de Mariana Zuvic: “Gildo Insfrán está involucrado en el narcotráfico en Formosa”"};
    const DATA_BY_VIDEO = {"JlZFjTFVjuE":[["parte",28],["policía",26],["tema",25],["parte policía",24],["policía parte",23],["fiscalía",22],["tema fiscalía",22],["fiscalía tema",21],["provincia",13],["formosa",11]],"fLi3VY802o8":[["parte",28],["policía",26],["tema",25],["parte policía",24],["policía parte",23],["fiscalía",22],["tema fiscalía",22],["fiscalía tema",21],["provincia",13],["formosa",11]],"pliyp3R-XYA":[["parte",28],["policía",26],["tema",25],["parte policía",24],["policía parte",23],["fiscalía",22],["tema fiscalía",22],["fiscalía tema",21],["provincia",13],["formosa",11]]};
    const DATA_ALL = [["parte",84],["policía",78],["tema",75],["parte policía",72],["policía parte",69],["fiscalía",66],["tema fiscalía",66],["fiscalía tema",63],["provincia",39],["formosa",33]];

    const container = document.getElementById('wordcloud');
    const maxSize = document.getElementById('maxSize');
    const rotate = document.getElementById('rotate');
    const regen  = document.getElementById('regen');
    const videoSelect = document.getElementById('videoSelect');
    const badgeCount = document.getElementById('badgeCount');

    // Poblar selector con los video_id disponibles (incluye opción Todos)
    function populateSelect() {
      // reset
      videoSelect.innerHTML = "";
      const optAll = document.createElement('option');
      optAll.value = 'ALL';
      optAll.textContent = 'Todos (consolidado)';
      videoSelect.appendChild(optAll);

      const ids = Object.keys(TITLES);
      ids.forEach(id => {
        const opt = document.createElement('option');
        opt.value = id;
        opt.textContent = `${TITLES[id]} (${id})`;
        videoSelect.appendChild(opt);
      });
      videoSelect.value = 'ALL';
    }

    function getCurrentData() {
      const vid = videoSelect.value;
      return vid === 'ALL' ? DATA_ALL : (DATA_BY_VIDEO[vid] || []);
    }

    function getMaxCount(list) {
      let max = 1;
      for (const item of list) { if (item[1] > max) max = item[1]; }
      return max;
    }

    function draw() {
      const LIST = getCurrentData();
      const MAX = getMaxCount(LIST);
      badgeCount.textContent = `Top ${LIST.length}`;

      const deg = parseInt(rotate.value, 10) || 0;
      const rad = deg * Math.PI / 180;
      container.innerHTML = '';
      WordCloud(container, {
        list: LIST,
        gridSize: Math.round(16 * (container.offsetWidth / 1024)),
        weightFactor: function (size) {
          const maxFont = parseInt(maxSize.value, 10) || 64;
          const val = (size / MAX) * maxFont;
          return Math.max(12, val);
        },
        minRotation: -rad,
        maxRotation:  rad,
        rotateRatio: 0.45,
        color: function() {
          const colors = ['#c00', '#555555', '#777777', '#000000'];
          return colors[Math.floor(Math.random() * colors.length)];
        },
        backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--panel').trim() || '#ffffff',
        drawOutOfBound: false,
        shuffle: true,
        ellipticity: 0.65,
        click: function (item) {
          const term = encodeURIComponent(item[0]);
          window.open(`https://www.google.com/search?q=${term}`, '_blank');
        }
      });
    }

    maxSize.addEventListener('input', draw);
    rotate.addEventListener('input', draw);
    regen.addEventListener('click', draw);
    videoSelect.addEventListener('change', draw);
    window.addEventListener('resize', draw);

    populateSelect();
    draw();
  </script>
</body>
</html>
